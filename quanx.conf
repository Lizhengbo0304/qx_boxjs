# QuantumultX 多功能脚本集合 - 重写订阅
# 说明：本配置包含 MITM、重写规则与任务，涵盖彩云天气、自动定位、**记账、住这儿模块
# 用法：可直接作为重写订阅导入，或复制到本地配置中使用
# 远程脚本托管：https://raw.githubusercontent.com/Lizhengbo0304/qx_boxjs/refs/heads/main/quanx.conf

[rewrite_local]
# ========================= 彩云天气（caiyun.js） =========================
# 功能：从高德地理编码接口获取经纬度，配合彩云天气进行天气通知
# 触发：请求头改写（script-request-header）
# 依赖：MITM restapi.amap.com
https:\/\/restapi\.amap\.com\/v3\/geocode\/geo url script-request-header https://raw.githubusercontent.com/Lizhengbo0304/qx_boxjs/refs/heads/main/caiyun.js

# ========================= 住这儿 Token 拦截（zhuzher-token-intercept.js） =========================
# 功能：拦截登录或 OAuth 刷新接口，自动保存 accessToken/refreshToken/userID 到 BoxJS
^https:\/\/api\.5th\.zone\/auth\/v3\/external\/oauth\/accessToken url script-response-body https://raw.githubusercontent.com/Lizhengbo0304/qx_boxjs/refs/heads/main/zhuzher-token-intercept.js
^https:\/\/api\.5th\.zone\/linksail\/api\/mobile\/login url script-response-body https://raw.githubusercontent.com/Lizhengbo0304/qx_boxjs/refs/heads/main/zhuzher-token-intercept.js

# ========================= **记账（kapi-accounting.js） =========================
# 功能：拦截并调整会员等级为 VIP，修改配置值
^https:\/\/api\.heylumi\.cn\/note\/note-api\/settings\/profile\/get url script-response-body https://raw.githubusercontent.com/Lizhengbo0304/qx_boxjs/refs/heads/main/kapi-accounting.js
^https:\/\/api\.heylumi\.cn\/note\/note-api\/common\/app\/config\/list url script-response-body https://raw.githubusercontent.com/Lizhengbo0304/qx_boxjs/refs/heads/main/kapi-accounting.js
^https:\/\/api\.heylumi\.cn\/note\/note-api\/user\/account\/status url script-response-body https://raw.githubusercontent.com/Lizhengbo0304/qx_boxjs/refs/heads/main/kapi-accounting.js

# ========================= 自动定位（locate.js） =========================
# 功能：通过系统天气调用触发位置更新，写入经纬度供其他脚本使用
# 说明：无需重写规则，仅需 MITM 支持

[mitm]
# 必要的主机名（按模块分类）
hostname = restapi.amap.com, api.heylumi.cn, api.5th.zone
# 住这儿：api.5th.zone
# 自动定位：weatherkit.apple.com, api.weather.com
# **记账：请将你的 App 域名加入此处（如：kapi.example.com）

[task_local]

# 说明：
# - 彩云天气（caiyun.js）：通过请求头改写触发，无需定时任务
# - 自动定位（locate.js）：系统天气触发，无需重写或任务
# - **记账（kapi-accounting.js）：请根据你的 App 域名启用相关规则
# - 住这儿（zhuzher-*）：拦截登录或刷新接口任一即可保存 Token，定时任务用于自动开门